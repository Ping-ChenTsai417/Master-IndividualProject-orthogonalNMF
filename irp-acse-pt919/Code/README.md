Weakly-supervised Learning of Pixel-level Labelling for Seismic Structures 
============================

The process of interpreting large quantity of seismic data for geologist requires high labour input and deep understanding of domain knowledge. The growing need of automatic seismic interpretation brings supervised machine learning approaches upfront to reduce work for manual interpretation. However, full supervision for training seismic structure segmentation relies on enormous labelled data. To obtain the training dataset, the interpreter needs to put a bounding box around the identified structures, and create a segmentation map for the box. It would be a very costly task for Ovation to prepare thousands of segmented data for training a neural network. To relax the training dependency on huge volumes of labels, the goal of this project is to automatically label seismic structures within a bounding box at pixel levels.  

Given a bounding box with label, the software tool aims to highlight the target seismic structures and hence pixel-level labelling. The tool may assist Ovation to detect untapped oil/gas reserveoirs more efficiently. Our project implements Non-negative Matrix Factorization with sparseness constraints to extract seismic features and their coordinations in a bounding box. The bounding boxes are expected to be catogorized and resized to the same shape before tool input.The tool eventually will generate binary masks for future use. The pixel labels prediction tool is evaluated by [jaccard-index](https://deepai.org/machine-learning-glossary-and-terms/jaccard-index) and [accuracy score](https://scikit-learn.org/stable/modules/generated/sklearn.metrics.accuracy_score.html) in this project. In this project, the experimental dataset is [LANDMASS](https://ieee-dataport.org/open-access/landmass).

### Requirements
- Python:
  - python 3.7
- Python packages:
  - Sklearn, Imageio, SciPy, PIL, os, scikit-image, matplotlib ...

  
### Installation Guide

To install the software and run the weakly-supervised model, run pip install in command line on a machine that has Git installed on it:

```
python -m pip install git https://github.com/acse-2019/irp-acse-pt919
```
### User Guide

[Code](https://github.com/Ping-ChenTsai417/Master-IndividualProject-orthogonalNMF/tree/master/irp-acse-pt919/Code) folder directs the user to five ```.py``` files.

**MainTest.py**
* Main function for testing the pixel labelling software. It contains step-by-step function calls to run the entire pixel labelling tool. The modulr utilised functions in ```NMF_Sparse.py```, ```label_Pixel.py``` and ```validate_Accuracy.py```. User should import data here. Since every dataset is different, the data importing step should be customed by users. Data matrix X is generated in this main function for further process. 

**tuneModel.py**
* Main function for checking how sparsity affect prediction accuracy. The workflow is similar to ```MainTest.py```, but with more iterations. 

**NMF_Sparse.py**
* This module contains functions related to [Non-negative matrix factorization with sparsity control](https://www.jmlr.org/papers/volume5/hoyer04a/hoyer04a.pdf). All input images should have the same dimension. The module is responsible for factors initialisation, apply sparseness constraints and run NMF model. It takes about 15 minutes to run through those tasks.

**label_Pixel.py**
* After obtaining NMF representations from ```NMF_Sparse.py```, current module is able to extract pixel-level labels from the representation. User can choose to export the predicted masks to their local machine by calling function ```save_toPath()```. ( User shoud define paths variables in the code in order to do so.)

**validate_Accuracy.py**
* Module for validating accuracy of masks prediction. To be noted that ```importMask()``` function is specifically written for importing png masks from local machine. Validating accuracy for prediction requires domain experts to create the seismic data ground truths beforehand. 

### Data

[Data](https://github.com/Ping-ChenTsai417/Master-IndividualProject-orthogonalNMF/tree/master/irp-acse-pt919/Data) folder directs the user several data files.
```images_Landmass.mat``` is the experimental input data used in this project. ```png``` contains the same LANDMASS images in .png format. ```ground truth``` are the masks generated by [CVAT](https://github.com/opencv/cvat) for accuracy validation.```predicted mask``` is the saved binary masks for LANDMASS predicted by the code.

### Documentation

The project code includes [Sphinx](https://www.sphinx-doc.org) documentation. After installing Sphinx, build the documentation by running command

``` 
python -m sphinx docs html
```

under ```./Documentation``` directory. Then a `index.html` file will be created in `./build/html` . Open the html file to view documentation.

For systems with [LaTeX](https://www.latex-project.org/get/) installed, a manual pdf can be generated by running

```
python -m sphinx  -b latex docs latex
```

Then following the instructions to process the `Pixel-level Label Prediction Tool.tex` file in the `latex` directory in your browser.

* Download our[Documentation for the pixel-level labelling tool](https://github.com/acse-2019/irp-acse-pt919/blob/master/Code/Documentation/build/html/index.html) to view documentation in your browser.

### Performance of the tool
Since the input of our NMF with sparsity model have no labels, we compare the predicted results with ground truth directly using Jaccard Index and Accuracy score. 
To see the performance of the model, run ```MainTest.py``` and set the plotMask flag to True in the function ```label_Pixel.plotLabels()```.

